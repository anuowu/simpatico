<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Simpatico: 5.4 Loops and Iterators</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Simpatico
   &#160;<span id="projectnumber">v1.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Simpatico - Simulation Package for Polymer and Molecular Liquids</a></li><li class="navelem"><a class="el" href="developer_page.html">5 Developer Information</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">5.4 Loops and Iterators </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="developer_param_page.html">5.3 Parameter File I/O</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="developer_mcMdData_page.html">5.5 Data Structures (mcSim and mdSim)</a> (Next) <br />
</p>
<p>Most loops in Simpatico are written using iterators, rather than simple for-loops.</p>
<h1><a class="anchor" id="iterator_iterator_section"></a>
Iterators</h1>
<p>The directory src/util/containers contains several class templates for iterators. Each iterator type allows iteration over the elements of one or more corresponding container types. The interface used for iterators in Simpatico is slightly different from that for C++ standard library iterators. All Simpatico iterators overload *, -&gt;, and (prefix) ++ operators. The meaning of these operators is identical to that for bare C pointers, or for C++ standard library iterators. In addition to these operators, however, each Simpatico iterator provides a bool method named ``notEnd()" that can be used to test for termination of a loop. A single Simaptico iterator can thus be used to implement a loop, whereas a pair of iterators (one of which is used to locate the end of a sequence) is normally requierd with C++ standard library iterators.</p>
<p>If ``iter" is the name of a Simpatico iterator that points to an object A of type T within a container, then </p><ul>
<li>
*iter returns object A by reference  </li>
<li>
iter-&gt;method() is equivalent to A.method()  </li>
<li>
++iter advances iter to the next element in the container.  </li>
<li>
iter.notEnd() returns false when iter no longer points to a valid element.  </li>
</ul>
<p>The notEnd() method returns true as long as the iterator points to a valid element in the sequence, and false when the iterator has already been incremented one past the last element in the sequence.</p>
<p>An iterator is initialized to point to the first element in a container by a member function of the container. Each Simpatico container template provides at least one method named begin(), which takes an iterator as its parameter, which is passed by reference. The interface for this method is always: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> begin(Iterator&amp; )</div></div><!-- fragment --><p> where Iterator denotes an associated iterator type. The begin() method modifies the iterator so as to point at the first element within the sequence stored by the container. It also passes the integrator the information required to identify the end of the sequence (e.g., the address of an element one past the last element, for a simple array container). The usual syntax for a loop that iterates over elements of a container is thus: </p><div class="fragment"><div class="line">Container container;</div><div class="line">Iterator  iter;</div><div class="line"><span class="keywordflow">for</span> (container.begin(iter); iter.notEnd(); ++i){</div><div class="line"></div><div class="line">   <span class="comment">// Do something with iter, using the iterator like a pointer.</span></div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p> where Container and Iterator represent associated container and iterator types.</p>
<p>There are actually two types of Iterator associated with each container template:</p>
<ul>
<li>A non-const forward iterator, which provides read-write (non-const) access to elements of the container, and</li>
<li>A const forward iterator, which provides read-only (const) access.</li>
</ul>
<p>The name of the class template for a const iterator always begins with the prefix Const. For example, Util::ArrayIterator&lt;T&gt; and Util::ConstArrayIterator&lt;T&gt; are the non-const and const iterator types for instances of one-dimensional arrays that store objects of type T. These iterator types are used by the container types Util::DArray&lt;T&gt; and Util::FArray&lt;T&gt;, and Util::SArray&lt;T&gt;. Two overloaded begin() methods are defined for each container, one of which takes an instance of the non-const iterator as an parameter, and the other of which takes a const iterator.</p>
<p>Loops over atoms, covalent groups (e.g,. bonds) and (in <a class="el" href="namespaceMcMd.html" title="Single-processor Monte Carlo (MC) and molecular dynamics (MD). ">McMd</a>) molecules are also implemented using iterators. Different interfaces are used in the <a class="el" href="namespaceMcMd.html" title="Single-processor Monte Carlo (MC) and molecular dynamics (MD). ">McMd</a> and <a class="el" href="namespaceDdMd.html" title="Parallel domain decomposition (DD) MD simulation. ">DdMd</a> namespaces, which are discussed separately below.</p>
<h1><a class="anchor" id="developer_iterator_mcMd_section"></a>
Iterators in mcSim and mdSim</h1>
<p>In mcSim and mdSim simulations, each <a class="el" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary. ">McMd::System</a> has a separate container of molecules for each species. The typedefs <a class="el" href="classMcMd_1_1System.html#aeee4a70e1f9b8194c170a48c8fa08826" title="Iterator for a MoleculeSet. ">McMd::System::MoleculeIterator</a> and <a class="el" href="classMcMd_1_1System.html#acb5f24a14ca6186cb63c0ef4a69107d7" title="Const Iterator for a MoleculeSet. ">McMd::System::ConstMoleculeIterator</a> are aliases for iterator types that can iterate over all molecules of a specific Species within one System. The <a class="el" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary. ">McMd::System</a> class provides overloaded begin() methods for these two iterator types. Each of the System::begin() method takes an integer species index and molecule iterator as parameters, and initialize the iterator to point at the first molecule in the specified species. The syntax for a loop over all molecule of a specific species with a System is thus: </p><div class="fragment"><div class="line">System system;</div><div class="line">System::MoleculeIterator molIter:</div><div class="line"></div><div class="line"><span class="comment">// Loop over molecules in species</span></div><div class="line"><span class="keywordflow">for</span> (system.begin(speciesId, molIter); molIter.notEnd(); ++molIter){</div><div class="line"></div><div class="line">    <span class="comment">// Do something with molIter, using a syntax similar to that for a pointer.</span></div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p> Here, the integer speciesId is the species index for a specific species. In and MC or MD simulation, the system would normally be an instance of the McSystem or MdSystem subclass, respectively, but the required begin() methods are defined by the <a class="el" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary. ">McMd::System</a> base class.</p>
<p>To iterate over all the atoms in an <a class="el" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary. ">McMd::System</a>, one must use a nested iteration over species, molecules, and atoms within each molecule. The typedef <a class="el" href="classMcMd_1_1Molecule.html#aa586d0226ef16a1ecce1d5e7b7630ee7" title="Iterator for Atoms within a Molecule. ">McMd::Molecule::AtomIterator</a> is an alias for the type of an iterator that can iterate over all Atom objects within a molecule. The <a class="el" href="classMcMd_1_1Molecule.html" title="A physical molecule (a set of covalently bonded Atoms). ">McMd::Molecule</a> class provides a begin() method that initializes an instance of Molecule::AtomIterator. The syntax for a loop over all atoms within all molecules of all species in a System is thus: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceMcMd.html">McMd</a></div><div class="line">{</div><div class="line"> </div><div class="line">   System system;</div><div class="line">   Simulation simulation;</div><div class="line">   <a class="code" href="classMcMd_1_1System.html#aeee4a70e1f9b8194c170a48c8fa08826">System::MoleculeIterator</a> molIter:</div><div class="line">   <a class="code" href="classMcMd_1_1Molecule.html#aa586d0226ef16a1ecce1d5e7b7630ee7">Molecule::AtomIterator</a> atomIter:</div><div class="line"></div><div class="line">   <span class="comment">// Loop over all molecular species</span></div><div class="line">   <span class="keywordtype">int</span> nSpecies = <a class="code" href="classMcMd_1_1Simulation.html#afa700c2440413cd98a8d47900c4bdc8d">Simulation::nSpecies</a>();</div><div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> speciesId = 0; speciesId &lt; nSpecies; ++speciesId) {</div><div class="line"></div><div class="line">      <span class="comment">// Loop over molecules in each species</span></div><div class="line">      <span class="keywordflow">for</span> (system.begin(species, molIter); !molIter.atEnd(); ++i){</div><div class="line"></div><div class="line">         <span class="comment">// Loop over atoms in each molecule</span></div><div class="line">         <span class="keywordflow">for</span> (molItr-&gt;begin(species, atomIter); !atomIter.atEnd(); ++atomIter){</div><div class="line"></div><div class="line">            <span class="comment">// Do something with each Atom, using atomIter as if it were a pointer.</span></div><div class="line"></div><div class="line">         }</div><div class="line"></div><div class="line">      }</div><div class="line"></div><div class="line">   }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="developer_iterator_ddMd_section"></a>
Iterators in ddSim</h1>
<p>In ddSim simulations, the <a class="el" href="classDdMd_1_1AtomStorage.html" title="A container for all the atoms and ghost atoms on this processor. ">DdMd::AtomStorage</a> member of the main <a class="el" href="classDdMd_1_1Simulation.html" title="Main object for a domain-decomposition MD simulation. ">DdMd::Simulation</a> acts as a container for all of the <a class="el" href="classDdMd_1_1Atom.html" title="A point particle in an MD simulation. ">DdMd::Atom</a> objects owned by a single processor. Their is no notion of a molecule or molecular species in the <a class="el" href="namespaceDdMd.html" title="Parallel domain decomposition (DD) MD simulation. ">DdMd</a> namespace: In this context, one must iterates directly over <a class="el" href="classDdMd_1_1Atom.html" title="A point particle in an MD simulation. ">DdMd::Atom</a> objects stored in an AtomStorage. There are two types of atoms stored in a AtomStorage container: "Local" atoms are atoms the are "owned" by this processor, because their positions lay within the domain associated with the processor the last time that ownership was assigned (which occurs whenever the pair list is rebuilt). "Ghost" atoms are atoms that are owned by neighboring processors, but that lie close enough to the boundaries of the spatial domain owned by this processor so that they can interact with local atoms, so that this processor needs to know their locations in order to calculate forces on local atoms. Different iterators types are defined for local and ghost atoms. The classes <a class="el" href="classDdMd_1_1AtomIterator.html" title="Iterator for all atoms owned by an AtomStorage. ">DdMd::AtomIterator</a> and <a class="el" href="classDdMd_1_1ConstAtomIterator.html" title="Const iterator for all atoms owned by an AtomStorage. ">DdMd::ConstAtomIterator</a> are non-const and const iterators that can iterate over all of local atoms owned by a processor, respectively. The classes <a class="el" href="classDdMd_1_1GhostIterator.html" title="Iterator for all ghost atoms owned by an AtomStorage. ">DdMd::GhostIterator</a> and <a class="el" href="classDdMd_1_1ConstGhostIterator.html" title="Iterator for all ghost atoms owned by an AtomStorage. ">DdMd::ConstGhostIterator</a> instead iterate over all of the ghost atoms on a processor.</p>
<p>The <a class="el" href="classDdMd_1_1AtomStorage.html" title="A container for all the atoms and ghost atoms on this processor. ">DdMd::AtomStorage</a> class defines four overloaded begin(Iterator&amp; ) methods for these four types of iterators, i.e., for non-const and const local and ghost atoms. Which type of atom and access is provided by the iterator is determined by the type of the iterator that is passed to the begin() method. The syntax for a loop that provides read-write access to all of the ``local" atoms on a processor (i.e., all of those owned by this processor) is simply </p><div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceDdMd.html">DdMd</a></div><div class="line">{</div><div class="line"></div><div class="line">   AtomStorage  atomStorage;</div><div class="line">   AtomIterator atomIter:</div><div class="line">   <span class="keywordflow">for</span> (atomStorage.begin(atomIter); atomIter.notEnd(); ++atomIter){</div><div class="line">      <span class="comment">// Do something with each Atom, using iterator atomIter</span></div><div class="line">   }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p> A corresponding loop over ghost atoms would simply use a <a class="el" href="classDdMd_1_1GhostIterator.html" title="Iterator for all ghost atoms owned by an AtomStorage. ">DdMd::GhostIterator</a> or <a class="el" href="classDdMd_1_1ConstGhostIterator.html" title="Iterator for all ghost atoms owned by an AtomStorage. ">DdMd::ConstGhostIterator</a> for the iterator.</p>
<p>The <a class="el" href="classDdMd_1_1GroupStorage.html" title="A container for all the Group&lt;N&gt; objects on this processor. ">DdMd::GroupStorage</a> class template provides a container for covalent groups such as covalent bonds. Instances of the DdMd::GroupStorage&lt;N&gt; template with N=2, 3 or 4 are containers for bond, angle and dihedral covalent Group&lt;N&gt; objects, respectively. Each Group&lt;N&gt; holds pointers to N <a class="el" href="classDdMd_1_1Atom.html" title="A point particle in an MD simulation. ">DdMd::Atom</a> objects. For example, a Group&lt;N&gt; object represents a 2-body covalent bond, and stores pointers to the two atoms that are connected by the bond. Each atom within a Group&lt;N&gt; may be either a local or ghost atom, but each group must contain at least one local atom. A DdMd::GroupStorage&lt;N&gt; container holds all of the Group&lt;N&gt; objects that include one or more atoms that are owned by this processor. The classes templaets DdMd::GroupIterator&lt;N&gt; and DdMd::ConstGroupIterator&lt;N&gt; are iterators that iterate over all the Group&lt;N&gt; objects in a GroupStorage&lt;N&gt; container. The syntax for iteration is similar to that for other Simpatico iterators and containers. Here is an example for a loop over covalent bonds (N=2): </p><div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceDdMd.html">DdMd</a></div><div class="line">{</div><div class="line"></div><div class="line">   GroupStorage&lt;2&gt;  bondStorage;</div><div class="line">   GroupIterator&lt;2&gt; bondIter:</div><div class="line">   <span class="keywordflow">for</span> (bondStorage.begin(bondIter); bondIter.notEnd(); ++bondIter){</div><div class="line">      <span class="comment">// Do something with bondIter</span></div><div class="line">   }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p> This could also be written using the typedefs BondStorage and BondIterator, which are simply aliases for <a class="el" href="classTools_1_1GroupStorage.html">GroupStorage&lt;2&gt;</a> and GroupIterator&lt;2&gt;, respectively. A corresponding loop over angles or dihedrals would be similar except for the use of a template argument N = 3 or N = 4, respectively, or the equivalent Angle or Dihedral typedefs (e.g., AngleStorage and AngleIterator).</p>
<p><br />
 <a class="el" href="developer_param_page.html">5.3 Parameter File I/O</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="developer_page.html">5 Developer Information</a> (Up) &#160; &#160; &#160; &#160; <a class="el" href="developer_mcMdData_page.html">5.5 Data Structures (mcSim and mdSim)</a> (Next) </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jan 8 2017 23:13:22 for Simpatico by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
