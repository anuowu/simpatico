<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Simpatico: 4.7 Modules</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Simpatico
   &#160;<span id="projectnumber">v1.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Simpatico - Simulation Package for Polymer and Molecular Liquids</a></li><li class="navelem"><a class="el" href="extend_page.html">4 Extending Simpatico</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">4.7 Modules </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="extend_subfactory_page.html">4.5 Sub-Factories</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="developer_page.html">5 Developer Information</a> (Next) <br />
</p>
<p>A module is a set of classes that were designed for a specific application area, packaged in a manner that is designed to facilitate use by people other than the developer.</p>
<h1><a class="anchor" id="extend_module_writing_sec"></a>
Writing a Module</h1>
<p>By convention, each module should be installed in a separate subdirectory of the modules/ directory of the relevant namespace level directory. A module named "stuff" that adds features to the mcSim and/or mdSim programs should thus installed in a directory src/mcMd/modules/stuff, and should contain source files for classes that are defined in the <a class="el" href="namespaceMcMd.html" title="Single-processor Monte Carlo (MC) and molecular dynamics (MD). ">McMd</a> namespace.</p>
<p>An example of complete <a class="el" href="namespaceMcMd.html" title="Single-processor Monte Carlo (MC) and molecular dynamics (MD). ">McMd</a> module is given in the directory src/mcMd/modules/slipLink directory. This module provides features that allow an mcSim Monte Carlo simulation to be used to simulate a model of polymer chains with transient slip-links between pairs of chains, for use as a coarse-grained model of entanglements in models with soft pair interactions that would otherwise allow polymers to cut throughou one another.</p>
<p>A module directory generally contains the following types of files:</p>
<ul>
<li>Feature Classes: Source files for a set of C++ "feature" classes that implement new features, such as data analysis algorithms, Monte Carlo moves or molecular dynamics integrators. Each feature class is generally a subclass of an appropriate base class defined in the same namespace.</li>
<li>Factory Classes: Source files for more associated factory classes that can construct instances of the feature classes, so that they can be added to a simulation at run time by adding appropriate blocks to a parameter file. For example, and <a class="el" href="namespaceMcMd.html" title="Single-processor Monte Carlo (MC) and molecular dynamics (MD). ">McMd</a> module that provides classes that are subclasses of both <a class="el" href="classMcMd_1_1Analyzer.html" title="Abstract base for periodic output and/or analysis actions. ">McMd::Analyzer</a> (data analysis algorithms) and subclasses of <a class="el" href="classMcMd_1_1McMove.html" title="McMove is an abstract base class for Monte Carlo moves. ">McMd::McMove</a> (Monte Carlo moves) would also include source files for a subclass of <a class="el" href="classMcMd_1_1Analyzer.html" title="Abstract base for periodic output and/or analysis actions. ">McMd::Analyzer</a> and a subclass of <a class="el" href="classMcMd_1_1McMove.html" title="McMove is an abstract base class for Monte Carlo moves. ">McMd::McMove</a>.</li>
<li>Makefiles: Makefiles and makefile fragments within a module follow conventions completely analogous to those used throughout the simpatico source code. Name conventions in these files should be based on the assumption that the module will be installed in a specific subdirectory of a modules/ directory within the simpatico src/ directory tree, and will be compiled along with the rest of the simpatico source code.</li>
<li>Module Wrapper Class: A module wrapper class is a class that has one or more Factory classes as member variables and that encapsulates the code required to register each of the module factory class as a subfactory of the corresponding default factory class. By convention, a module wrapper class has a constructor that takes the main simulation object as an argument and that registers each such module factory class as a subfactory of the corresponding default factory class.</li>
</ul>
<p>The module defined in src/mcMd/modules/slipLink contains source files that define two factory classes named <a class="el" href="classMcMd_1_1SliplinkMcAnalyzerFactory.html" title="Custom AnalyzerFactory for an McSimulation. ">SliplinkMcAnalyzerFactory</a> and <a class="el" href="classMcMd_1_1SliplinkMcMoveFactory.html" title="Custom McMoveFactory. ">SliplinkMcMoveFactory</a>, which are used to construct <a class="el" href="classMcMd_1_1Analyzer.html" title="Abstract base for periodic output and/or analysis actions. ">Analyzer</a> and <a class="el" href="classMcMd_1_1McMove.html" title="McMove is an abstract base class for Monte Carlo moves. ">McMove</a> feature classes, respectively. The implementation of the factory() member function of each such factory class can construct an instance of any of the feature classes of the appropriate type and return a pointer to this new object when passed the appropriate class name as an argument. See the source files for these classes for examples.</p>
<p>The sliplink module also contains a module wrapper class named <a class="el" href="classMcMd_1_1SliplinkMcModule.html" title="Module for slip link simulation. ">SliplinkMcModule</a> that is designed to integrates the module into an mcSim Monte Carlo simulation. This class has instances of <a class="el" href="classMcMd_1_1SliplinkMcAnalyzerFactory.html" title="Custom AnalyzerFactory for an McSimulation. ">SliplinkMcAnalyzerFactory</a> and <a class="el" href="classMcMd_1_1SliplinkMcMoveFactory.html" title="Custom McMoveFactory. ">SliplinkMcMoveFactory</a> as member variables. The constructor for this class, implemented in the file src/mcMd/moduless/sliplink/SliplinkMcModule.cpp, takes a reference to the parent <a class="el" href="classMcMd_1_1McSimulation.html" title="A Monte-Carlo simulation of one McSystem. ">McSimulation</a> object as an argument and includes statements that register instances of the factory classes defined in the module as subfactories of the corresponding default factory classes.</p>
<h1><a class="anchor" id="extend_module_use_sec"></a>
Using a Module</h1>
<p>To compile a simpatico program that uses a particular module, a user must generally go through the following set of steps:</p>
<ul>
<li>Install the contents of the directory containing the module source files in the appropriate location within a modules/ directory in the users simpatico src/ directory tree.</li>
<li>Modify the sources.mk file in the relevant modules/ directory (i.e., mcMd/modules or ddMd/modules) so as to enable the new module to be compiled along with the rest of the source code. Notes about how to do this are given in the default copy of this sources.mk file.</li>
<li>Use the configure script or edit the appropriate config.mk files to enable any features of simpatico that are required for the module to function. In the case of the <a class="el" href="namespaceMcMd.html" title="Single-processor Monte Carlo (MC) and molecular dynamics (MD). ">McMd</a> sliplink module that is provided as an example, the user must uncomment the line that defines the macro MCMD_LINK in the file src/mcMd/config.mk before compiling to enable the use of slip links throughout the source code.</li>
<li>Modify the relevant main program so as to include the header file for the module wrapper class and to construct an instance of that class (see below for an example).</li>
<li>Compile all the code in the namespace containing the relevant simpatico program or programs, by entering "make mcMd" or "make ddMd".</li>
</ul>
<h1><a class="anchor" id="extend_module_main_sec"></a>
Adding a Module to the Main Program</h1>
<p>In order to use the slipLink module, which is designed to be used with the mcSim program, the user would have to modify the main MC program, in file <a class="el" href="mcSim_8cpp_source.html">src/mcMd/mcSim.cpp</a>, by adding a line </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;mcMd/modules/sliplink/SliplinkMcModule.h&gt;</span></div></div><!-- fragment --><p> to include the header file for the module wrapper class, and adding a line </p><div class="fragment"><div class="line"><a class="code" href="classMcMd_1_1SliplinkMcModule.html">McMd::SliplinkMcModule</a> module(simulation);</div></div><!-- fragment --><p> to create an instance of that class, in which simulation is the name of the main <a class="el" href="classMcMd_1_1McSimulation.html" title="A Monte-Carlo simulation of one McSystem. ">McMd::McSimulation</a> object. Since the constructor for the module wrapper class takes the main simulation object as an argument, the <a class="el" href="classMcMd_1_1SliplinkMcModule.html" title="Module for slip link simulation. ">SliplinkMcModule</a> object must be constructed after the main simulation object but before reading the parameter file.</p>
<p>The resulting modified main program, with some comments removed, is shown below:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;mcMd/mcSimulation/McSimulation.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;mcMd/modules/sliplink/SliplinkMcModule.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line"><span class="preprocessor">   #ifdef UTIL_MPI</span></div><div class="line">   MPI::Init();</div><div class="line">   <a class="code" href="classMcMd_1_1McSimulation.html">McMd::McSimulation</a> simulation(MPI::COMM_WORLD);</div><div class="line"><span class="preprocessor">   #else</span></div><div class="line">   <a class="code" href="classMcMd_1_1McSimulation.html">McMd::McSimulation</a> simulation;</div><div class="line"><span class="preprocessor">   #endif</span></div><div class="line"></div><div class="line">   <span class="comment">// Create an instance of the module wrapper</span></div><div class="line">   <a class="code" href="classMcMd_1_1SliplinkMcModule.html">McMd::SliplinkMcModule</a> module(simulation);</div><div class="line"></div><div class="line">   <span class="comment">// Process command line options</span></div><div class="line">   simulation.<a class="code" href="classMcMd_1_1McSimulation.html#a913a54f9d2f6ee42dbd6aad6ebeac486">setOptions</a>(argc, argv);</div><div class="line"></div><div class="line">   <span class="comment">// Read parameters from default parameter file</span></div><div class="line">   simulation.<a class="code" href="classMcMd_1_1McSimulation.html#a68589aa58b154b1739f99e8ed443a268">readParam</a>();</div><div class="line">   </div><div class="line">   <span class="comment">// Read command script to run simulation</span></div><div class="line">   simulation.<a class="code" href="classMcMd_1_1McSimulation.html#ac743d5ae517c8da8f087e573635d11da">readCommands</a>();</div><div class="line"></div><div class="line"><span class="preprocessor">   #ifdef UTIL_MPI</span></div><div class="line">   MPI::Finalize();</div><div class="line"><span class="preprocessor">   #endif</span></div><div class="line"></div><div class="line">   <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p> Because the code to register any factory classes defined in a module is invoked in the constructor of the module wrapper class, the user merely has to create an instance of the module wrapper class in order to enable use of the corresponding module.</p>
<p>Note that users are free to modify the user copy of files that contain any file such as mcSim.cpp that contains the main program for a simulation, because these main simulation program files are not kept under repository control. Instead, the the default repository version of each such main program file is kept in a separate file named, e.g., mcSim.cpp_r, that is under repository control and a copy of the user file is created by the setup script by making a copy of the repository version. This scheme is used throughout the simpatico source code to distinguish user files that users might need to edit from default respository versions of the same file.</p>
<p><br />
 <a class="el" href="extend_subfactory_page.html">4.5 Sub-Factories</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="extend_page.html">4 Extending Simpatico</a> (Up) &#160; &#160; &#160; &#160; <a class="el" href="developer_page.html">5 Developer Information</a> (Next) </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Mar 7 2018 12:59:45 for Simpatico by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
